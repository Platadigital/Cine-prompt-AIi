<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CinePrompt AI</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Inter Font -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
    <style>
        /* Apply Inter font to body and headings */
        body {
            font-family: 'Inter', sans-serif;
        }
        h1, h2, h3, h4, h5, h6 {
            font-family: 'Inter', sans-serif;
        }

        /* Keyframes for subtle pulsating border glow on entry page */
        @keyframes pulse-border-subtle {
            0% { border-color: rgba(168, 85, 247, 0.1); box-shadow: 0 0 2px rgba(168, 85, 247, 0.05); }
            50% { border-color: rgba(168, 85, 247, 0.3); box-shadow: 0 0 5px rgba(168, 85, 247, 0.15); }
            100% { border-color: rgba(168, 85, 247, 0.1); box-shadow: 0 0 2px rgba(168, 85, 247, 0.05); }
        }
        .pulsing-border-subtle {
            animation: pulse-border-subtle 3.5s infinite ease-in-out;
        }

        /* Keyframes for abstract and dynamic background */
        @keyframes futuristic-background-animation {
            0% { background-position: 0% 0%, 50% 50%, 100% 100%; }
            100% { background-position: 100% 100%, 0% 0%, 50% 50%; }
        }

        .futuristic-background {
            background:
                radial-gradient(circle at 20% 30%, rgba(168, 85, 247, 0.05) 0%, transparent 40%), /* More subtle purple */
                radial-gradient(circle at 80% 70%, rgba(59, 130, 246, 0.05) 0%, transparent 40%), /* More subtle blue */
                linear-gradient(160deg, #0a0a0a, #1a1a1a, #0a0a0a); /* Dark gray gradient for depth */
            background-size: 300% 300%, 300% 300%, 100% 100%;
            animation: futuristic-background-animation 50s ease infinite alternate; /* Slower and smoother animation */
        }

        /* Enhanced and more discreet Glassmorphism effect */
        .glass-effect {
            background-color: rgba(30, 41, 59, 0.3); /* More transparent */
            backdrop-filter: blur(15px); /* Moderate blur */
            -webkit-backdrop-filter: blur(15px);
            border: 1px solid rgba(71, 85, 105, 0.15); /* More visible border */
            box-shadow: 0 2px 12px rgba(0, 0, 0, 0.15), inset 0 0 6px rgba(168, 85, 247, 0.05); /* More subtle outer shadow and inner glow */
        }

        /* Adjustments for button and title glow in the rest of the app */
        .text-neon-glow {
            text-shadow: none; /* Glow removed */
            animation: none; /* Static in main app */
        }
        .text-neon-glow-subtle { /* Glow removed */
            text-shadow: none;
        }
        
        button {
            box-shadow: 0 0 3px rgba(168, 85, 247, 0.1); /* Softer base shadow */
            transition: box-shadow 0.3s ease-in-out, transform 0.1s ease-out;
        }
        button:hover {
            box-shadow: 0 0 10px rgba(168, 85, 247, 0.4), 0 0 15px rgba(168, 85, 247, 0.2); /* More defined, but subtle hover glow */
            transform: translateY(-1px); /* Slight elevation on hover */
        }
        .bg-blue-600:hover { box-shadow: 0 0 10px rgba(59, 130, 246, 0.4), 0 0 15px rgba(59, 130, 246, 0.2); }
        .bg-emerald-600:hover { box-shadow: 0 0 10px rgba(16, 185, 129, 0.4), 0 0 15px rgba(16, 185, 129, 0.2); }
        .bg-red-600:hover { box-shadow: 0 0 10px rgba(239, 68, 68, 0.4), 0 0 15px rgba(239, 68, 68, 0.2); }
        .bg-gray-700:hover { box-shadow: 0 0 8px rgba(156, 163, 175, 0.4), 0 0 10px rgba(156, 163, 175, 0.2); }

        .glass-effect-input-subtle {
            background-color: rgba(45, 55, 72, 0.3); /* bg-gray-700 with increased opacity */
            backdrop-filter: blur(5px);
            -webkit-backdrop-filter: blur(5px);
            border: 1px solid rgba(71, 85, 105, 0.15); /* More visible border */
        }

        /* New variable for softer purple */
        :root {
            --color-soft-purple: #a87fe7; /* A lighter, less saturated purple */
        }
        .text-soft-purple {
            color: var(--color-soft-purple);
        }

        /* Custom scrollbar for multi-select */
        select[multiple] {
            -webkit-overflow-scrolling: touch; /* Enable smooth scrolling on iOS */
            scrollbar-width: thin; /* Firefox */
            scrollbar-color: #8b5cf6 #4b5563; /* thumb and track color for Firefox */
        }
        select[multiple]::-webkit-scrollbar {
            width: 8px;
        }
        select[multiple]::-webkit-scrollbar-track {
            background: #4b5563; /* bg-gray-700 */
            border-radius: 10px;
        }
        select[multiple]::-webkit-scrollbar-thumb {
            background-color: #8b5cf6; /* purple-500 */
            border-radius: 10px;
            border: 2px solid #4b5563; /* padding around thumb */
        }
    </style>
</head>
<body class="min-h-screen bg-gray-950 text-gray-100 font-sans flex flex-col futuristic-background">

    <!-- Entry Page -->
    <div id="entry-page" class="min-h-screen bg-gray-950 text-gray-100 font-sans flex flex-col items-center justify-center futuristic-background p-4">
        <!-- Background Video on Entry Page -->
        <video id="entry-page-video" autoplay loop muted playsinline class="absolute inset-0 w-full h-full object-cover z-0" src="https://firebasestorage.googleapis.com/v0/b/platamais.firebasestorage.app/o/projeto%20vm%2FVIDEO%20CAPA%20NEO%20CINE%20PROMP.mp4?alt=media&token=a5037c56-def0-447d-8b22-5d18e7ec3e76" onerror="document.getElementById('entry-page-video-fallback').style.display='flex'; this.style.display='none';"></video>
        <div id="entry-page-video-fallback" class="absolute inset-0 w-full h-full object-cover z-0 items-center justify-center bg-gray-800 text-gray-400 text-center hidden">
            <span>Erro ao carregar o vídeo da capa. Verifique o URL.</span>
        </div>
        <!-- Overlay layer for readability -->
        <div class="absolute inset-0 bg-black opacity-40 z-10"></div> <!-- Dark layer over video -->

        <div class="text-center">
            <img
                src="https://firebasestorage.googleapis.com/v0/b/platamais.firebasestorage.app/o/projeto%20vm%2Flogo%20conecta.png?alt=media&token=320f1061-918f-4bda-8585-c741efd227c1"
                alt="Logo Conecta"
                class="h-48 md:h-64 w-auto mx-auto mb-8 pulsing-border-subtle rounded-lg relative z-20"
                style="border: 2px solid transparent;"
            />
            <h1 class="text-4xl md:text-6xl font-extrabold text-white mb-4 relative z-20">
                <span>Bem-vindo ao</span> <span class="text-purple-400">CinePrompt AI</span>
            </h1>
            <p class="text-xl md:text-2xl font-semibold mb-10 relative z-20">
                <span class="text-soft-purple">Sua Visão Cinematográfica, Gerada com</span> <span class="text-white text-2xl md:text-4xl font-extrabold">Inteligência</span>.
            </p>
            <button
                id="enter-platform-button"
                class="bg-purple-600 hover:bg-purple-700 text-white font-bold py-4 px-12 rounded-lg text-xl shadow-lg transition-all duration-300 hover:shadow-purple-500/80 border border-purple-500 relative overflow-hidden z-20"
            >
                Entrar na Plataforma
                <span class="absolute inset-0 bg-white opacity-0 transition-opacity duration-300 hover:opacity-10"></span>
            </button>
        </div>
    </div>

    <!-- Main App Container (hidden initially) -->
    <div id="main-app" class="min-h-screen bg-gray-950 text-gray-100 font-sans flex flex-col futuristic-background hidden">
        <!-- Header -->
        <header class="bg-gray-900 p-4 shadow-lg border-b-2 border-purple-700 glass-effect relative overflow-hidden min-h-[300px] flex flex-col">
            <!-- Header Background Video -->
            <video id="header-media-video" autoplay loop muted playsinline class="absolute inset-0 w-full h-full object-cover z-0" src="https://firebasestorage.googleapis.com/v0/b/platamais.firebasestorage.app/o/projeto%20vm%2FUntitled%20design.mp4?alt=media&token=623eef00-b722-4a64-8e27-b2bf831d5ebc" onerror="document.getElementById('header-media-fallback').style.display='flex'; this.style.display='none';"></video>
            <div id="header-media-fallback" class="absolute inset-0 w-full h-full object-cover z-0 items-center justify-center bg-gray-800 text-gray-400 text-center hidden">
                <span>Erro ao carregar o vídeo de apresentação. Verifique o URL.</span>
            </div>
            <!-- Overlay layer for readability -->
            <div class="absolute inset-0 bg-black opacity-40 z-10"></div>

            <div class="container mx-auto flex justify-between items-start relative z-20 pt-4">
                <div class="flex items-center">
                    <img
                        src="https://firebasestorage.googleapis.com/v0/b/platamais.firebasestorage.app/o/projeto%20vm%2Flogo%20conecta.png?alt=media&token=320f1061-918f-4bda-8585-c741efd227c1"
                        alt="Logo Conecta"
                        class="h-16 w-auto mr-4"
                    />
                </div>
                <!-- Mobile menu button -->
                <div class="md:hidden">
                    <button id="sidebar-toggle" class="text-gray-100 focus:outline-none">
                        <svg id="menu-icon" xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-menu"><line x1="4" x2="20" y1="12" y2="12"/><line x1="4" x2="20" y1="6" y2="6"/><line x1="4" x2="20" y1="18" y2="18"/></svg>
                        <svg id="x-icon" xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-x hidden"><path d="M18 6 6 18"/><path d="m6 6 12 12"/></svg>
                    </button>
                </div>
                <!-- Desktop Navigation -->
                <nav class="hidden md:flex space-x-8">
                    <a href="#" class="text-gray-300 hover:text-purple-400 transition-colors duration-200 flex items-center group relative">
                        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-layout-grid mr-1"><rect width="7" height="7" x="3" y="3" rx="1"/><rect width="7" height="7" x="14" y="3" rx="1"/><rect width="7" height="7" x="14" y="14" rx="1"/><rect width="7" height="7" x="3" y="14" rx="1"/></svg> Templates
                        <span class="absolute bottom-0 left-0 w-full h-0.5 bg-purple-500 scale-x-0 group-hover:scale-x-100 transition-transform duration-300"></span>
                    </a>
                    <button id="my-characters-button-desktop" class="text-gray-300 hover:text-purple-400 transition-colors duration-200 flex items-center group relative">
                        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-users mr-1"><path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M22 21v-2a4 4 0 0 0-3-3.87"/><path d="M16 3.13a4 4 0 0 1 0 7.75"/></svg> Meus Personagens
                        <span class="absolute bottom-0 left-0 w-full h-0.5 bg-purple-500 scale-x-0 group-hover:scale-x-100 transition-transform duration-300"></span>
                    </button>
                    <a href="#" class="text-gray-300 hover:text-purple-400 transition-colors duration-200 flex items-center group relative">
                        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-history mr-1"><path d="M21 12a9 9 0 1 1-9-9c2.52 0 4.93 1 6.74 2.74L21 8"/><path d="M21 3v5h-5"/><path d="M12 7v6h4"/></svg> Histórico
                        <span class="absolute bottom-0 left-0 w-full h-0.5 bg-purple-500 scale-x-0 group-hover:scale-x-100 transition-transform duration-300"></span>
                    </a>
                    <button id="plans-button-desktop" class="text-gray-300 hover:text-purple-400 transition-colors duration-200 flex items-center group relative">
                        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-dollar-sign mr-1"><line x1="12" x2="12" y1="2" y2="22"/><path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"/></svg> Planos
                        <span class="absolute bottom-0 left-0 w-full h-0.5 bg-purple-500 scale-x-0 group-hover:scale-x-100 transition-transform duration-300"></span>
                    </button>
                    <div id="auth-buttons-desktop" class="flex items-center space-x-8">
                        <!-- Rendered by JS -->
                    </div>
                </nav>
            </div>
            <div class="container mx-auto flex justify-center items-end relative z-20 flex-grow pb-4">
                <input type="text" id="header-media-url-input" placeholder="URL do Vídeo de Apresentação no Cabeçalho" class="w-full max-w-lg shadow appearance-none border border-gray-600 rounded-lg py-2 px-3 bg-gray-700 text-gray-100 leading-tight focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-transparent transition-all duration-200 glass-effect-input-subtle" />
            </div>
        </header>

        <!-- Subtitle -->
        <div class="w-full text-center py-4 bg-gray-900 border-b border-gray-700 shadow-inner glass-effect">
            <h2 class="text-xl md:text-3xl font-extrabold text-white">
                <span>Seu Prompt,</span> <span class="text-soft-purple">Resultado Cinematográfico</span>
            </h2>
            <p class="text-md md:text-xl font-semibold relative z-20">
                <span class="text-soft-purple">Sua Visão Cinematográfica, Gerada com</span> <span class="text-white text-2xl md:text-4xl font-extrabold">Inteligência</span>.
            </p>
        </div>

        <!-- Sidebar for Mobile -->
        <div id="mobile-sidebar" class="fixed inset-y-0 right-0 w-64 bg-gray-900 z-50 transform translate-x-full transition-transform duration-300 ease-in-out md:hidden glass-effect">
            <div class="p-4 flex justify-between items-center border-b border-gray-700">
                <h2 class="text-xl font-bold text-purple-500">Menu</h2>
                <button id="sidebar-close-button" class="text-gray-100 focus:outline-none">
                    <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-x"><path d="M18 6 6 18"/><path d="m6 6 12 12"/></svg>
                </button>
            </div>
            <nav class="flex flex-col p-4 space-y-4">
                <a href="#" class="text-gray-300 hover:text-purple-400 transition-colors duration-200 flex items-center sidebar-link">
                    <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-layout-grid mr-2"><rect width="7" height="7" x="3" y="3" rx="1"/><rect width="7" height="7" x="14" y="3" rx="1"/><rect width="7" height="7" x="14" y="14" rx="1"/><rect width="7" height="7" x="3" y="14" rx="1"/></svg> Templates
                </a>
                <button id="my-characters-button-mobile" class="text-gray-300 hover:text-purple-400 transition-colors duration-200 flex items-center w-full text-left sidebar-link">
                    <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-users mr-2"><path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M22 21v-2a4 4 0 0 0-3-3.87"/><path d="M16 3.13a4 4 0 0 1 0 7.75"/></svg> Meus Personagens
                </button>
                <a href="#" class="text-gray-300 hover:text-purple-400 transition-colors duration-200 flex items-center sidebar-link">
                    <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-history mr-2"><path d="M21 12a9 9 0 1 1-9-9c2.52 0 4.93 1 6.74 2.74L21 8"/><path d="M21 3v5h-5"/><path d="M12 7v6h4"/></svg> Histórico
                </a>
                <button id="plans-button-mobile" class="text-gray-300 hover:text-purple-400 transition-colors duration-200 flex items-center w-full text-left sidebar-link">
                    <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-dollar-sign mr-2"><line x1="12" x2="12" y1="2" y2="22"/><path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"/></svg> Planos
                </button>
                <div id="auth-buttons-mobile" class="flex flex-col space-y-4">
                    <!-- Rendered by JS -->
                </div>
            </nav>
        </div>

        <!-- Global Feedback Message -->
        <div id="feedback-message" class="fixed top-4 left-1/2 -translate-x-1/2 z-50 p-3 rounded-lg shadow-xl flex items-center space-x-2 text-white transition-all duration-300 ease-in-out hidden">
            <svg id="feedback-icon-success" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-check-circle hidden"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/><path d="m9 11 3 3L22 4"/></svg>
            <svg id="feedback-icon-error" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-alert-circle hidden"><circle cx="12" cy="12" r="10"/><line x1="12" x2="12" y1="8" y2="12"/><line x1="12" x2="12.01" y1="16" y2="16"/></svg>
            <span id="feedback-text"></span>
        </div>

        <!-- Authentication Modal -->
        <div id="auth-modal" class="fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50 p-4 hidden">
            <div class="bg-gray-800 p-6 rounded-xl shadow-lg w-full max-w-md border border-purple-700 glass-effect">
                <div class="flex justify-between items-center mb-6 border-b border-gray-700 pb-4">
                    <h2 id="auth-modal-title" class="text-2xl font-bold text-purple-400 flex items-center">
                        <svg id="auth-icon-user-plus" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-user-plus mr-2 hidden"><path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><line x1="19" x2="19" y1="8" y2="14"/><line x1="22" x2="16" y1="11" y2="11"/></svg>
                        <svg id="auth-icon-log-in" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-log-in mr-2 hidden"><path d="M15 3h4a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2h-4"/><polyline points="10 17 15 12 10 7"/><line x1="15" x2="3" y1="12" y2="12"/></svg>
                        Login
                    </h2>
                    <button id="auth-modal-close" class="text-gray-400 hover:text-white transition-colors">
                        <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-x"><path d="M18 6 6 18"/><path d="m6 6 12 12"/></svg>
                    </button>
                </div>
                <form id="auth-form">
                    <div class="mb-4">
                        <label class="block text-gray-300 text-sm font-bold mb-2 flex items-center">
                            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-mail mr-2 text-purple-400"><rect width="20" height="16" x="2" y="4" rx="2"/><path d="m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7"/></svg>
                            E-mail
                        </label>
                        <input type="email" id="auth-email" placeholder="seu@email.com" class="shadow appearance-none border border-gray-600 rounded-lg w-full py-2 px-3 bg-gray-700 text-gray-100 leading-tight focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-transparent transition-all duration-200 glass-effect-input-subtle" />
                    </div>
                    <div class="mb-4">
                        <label class="block text-gray-300 text-sm font-bold mb-2 flex items-center">
                            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-lock mr-2 text-purple-400"><rect width="18" height="11" x="3" y="11" rx="2" ry="2"/><path d="M7 11V7a5 5 0 0 1 10 0v4"/></svg>
                            Senha
                        </label>
                        <input type="password" id="auth-password" placeholder="••••••••" class="shadow appearance-none border border-gray-600 rounded-lg w-full py-2 px-3 bg-gray-700 text-gray-100 leading-tight focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-transparent transition-all duration-200 glass-effect-input-subtle" />
                    </div>
                    <button type="submit" id="auth-submit-button" class="mt-4 w-full bg-purple-600 hover:bg-purple-700 text-white font-bold py-3 px-6 rounded-lg shadow-lg transition-all duration-300 transform hover:scale-105 hover:shadow-purple-500/50">
                        Entrar
                    </button>
                </form>
                <div class="mt-6 text-center text-gray-400">
                    <span id="auth-toggle-text">Não tem uma conta? <button id="auth-toggle-button" class="text-blue-400 hover:underline">Cadastre-se</button></span>
                </div>
                <div class="mt-4 border-t border-gray-700 pt-4">
                    <button id="google-sign-in-button" class="w-full bg-red-600 hover:bg-red-700 text-white font-bold py-3 px-6 rounded-lg shadow-lg transition-all duration-300 transform hover:scale-105 hover:shadow-red-500/50 flex items-center justify-center">
                        <img src="https://www.gstatic.com/firebasejs/ui/2.0.0/images/auth/google.svg" alt="Google" class="w-6 h-6 mr-2" />
                        Entrar com Google
                    </button>
                </div>
            </div>
        </div>

        <!-- User Profile Modal -->
        <div id="profile-modal" class="fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50 p-4 hidden">
            <div class="bg-gray-800 p-6 rounded-xl shadow-lg w-full max-w-md border border-purple-700 glass-effect">
                <div class="flex justify-between items-center mb-6 border-b border-gray-700 pb-4">
                    <h2 class="text-2xl font-bold text-purple-400 flex items-center">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-user-circle mr-2"><circle cx="12" cy="12" r="10"/><circle cx="12" cy="10" r="3"/><path d="M7 20.662V19a2 2 0 0 1 2-2h6a2 2 0 0 1 2 2v1.662"/></svg> Meu Perfil
                    </h2>
                    <button id="profile-modal-close" class="text-gray-400 hover:text-white transition-colors">
                        <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-x"><path d="M18 6 6 18"/><path d="m6 6 12 12"/></svg>
                    </button>
                </div>
                <div class="mb-4">
                    <p class="text-gray-300 text-sm font-bold mb-2">E-mail:</p>
                    <p id="profile-email" class="text-gray-100 bg-gray-700 p-2 rounded-lg"></p>
                </div>
                <div class="mb-4">
                    <label class="block text-gray-300 text-sm font-bold mb-2 flex items-center">
                        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-credit-card mr-2 text-purple-400"><rect width="20" height="14" x="2" y="5" rx="2"/><line x1="2" x2="22" y1="10" y2="10"/></svg>
                        CPF
                    </label>
                    <input type="text" id="profile-cpf" placeholder="000.000.000-00" class="shadow appearance-none border border-gray-600 rounded-lg w-full py-2 px-3 bg-gray-700 text-gray-100 leading-tight focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-transparent transition-all duration-200 glass-effect-input-subtle" />
                    <p class="text-gray-400 text-xs mt-1">Seu CPF será usado apenas para identificação da conta.</p>
                </div>
                <button id="save-profile-button" class="mt-4 w-full bg-purple-600 hover:bg-purple-700 text-white font-bold py-3 px-6 rounded-lg shadow-lg transition-all duration-300 transform hover:scale-105 hover:shadow-purple-500/50">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-save mr-2"><path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"/><polyline points="17 21 17 13 7 13 7 21"/><polyline points="7 3 7 8 15 8"/></svg> Salvar Perfil
                </button>
            </div>
        </div>

        <!-- Subscription Plans Modal -->
        <div id="plans-modal" class="fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50 p-4 hidden">
            <div class="bg-gray-800 p-6 rounded-xl shadow-lg w-full max-w-3xl border border-purple-700 glass-effect">
                <div class="flex justify-between items-center mb-6 border-b border-gray-700 pb-4">
                    <h2 class="text-2xl font-bold text-purple-400 flex items-center">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-dollar-sign mr-2"><line x1="12" x2="12" y1="2" y2="22"/><path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"/></svg> Nossos Planos
                    </h2>
                    <button id="plans-modal-close" class="text-gray-400 hover:text-white transition-colors">
                        <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-x"><path d="M18 6 6 18"/><path d="m6 6 12 12"/></svg>
                    </button>
                </div>
                <div class="grid md:grid-cols-2 gap-6">
                    <!-- Free Plan -->
                    <div class="bg-gray-700 p-6 rounded-lg border border-gray-600 shadow-md flex flex-col glass-effect">
                        <h3 class="text-2xl font-bold text-blue-400 mb-3">Gratuito</h3>
                        <p class="text-gray-300 mb-4">Perfeito para começar e experimentar a ferramenta.</p>
                        <p class="text-4xl font-extrabold text-white mb-4">R$ 0<span class="text-lg text-gray-400">/mês</span></p>
                        <ul class="list-disc list-inside text-gray-300 flex-grow">
                            <li>3 prompts por dia</li>
                            <li>Acesso limitado a templates</li>
                            <li>Gerenciamento de 1 personagem</li>
                            <li>Suporte básico</li>
                        </ul>
                        <button class="mt-6 w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-6 rounded-lg shadow-lg transition-all duration-300 hover:shadow-blue-500/50">
                            Plano Atual
                        </button>
                    </div>

                    <!-- Pro Plan -->
                    <div class="bg-gradient-to-br from-purple-800 to-gray-800 p-6 rounded-lg border border-purple-500 shadow-xl flex flex-col relative overflow-hidden glass-effect">
                        <span class="absolute top-0 right-0 bg-yellow-500 text-gray-900 text-xs font-bold px-3 py-1 rounded-bl-lg">MAIS POPULAR</span>
                        <h3 class="text-2xl font-bold text-purple-300 mb-3">Pro</h3>
                        <p class="text-gray-300 mb-4">Para criadores e estúdios que buscam resultados ilimitados.</p>
                        <p class="text-4xl font-extrabold text-white mb-4">R$ 49,90<span class="text-lg text-gray-400">/mês</span></p>
                        <ul class="list-disc list-inside text-gray-300 flex-grow">
                            <li>Prompts ilimitados</li>
                            <li>Acesso a todos os templates premium</li>
                            <li>Gerenciamento ilimitado de personagens</li>
                            <li>Suporte prioritário</li>
                            <li>Exportação para .json (futuro)</li>
                        </ul>
                        <button class="mt-6 w-full bg-emerald-600 hover:bg-emerald-700 text-white font-bold py-3 px-6 rounded-lg shadow-lg transition-all duration-300 hover:shadow-emerald-500/50">
                            Assinar Plano Pro
                        </button>
                    </div>
                </div>
                <p class="text-gray-400 text-sm mt-6 text-center">
                    *Os valores das mensalidades são para fins de demonstração. Em um sistema real, seriam configurados via painel administrativo e processados por um gateway de pagamento como o Stripe.
                </p>
            </div>
        </div>

        <!-- Character Management Modal -->
        <div id="character-manager-modal" class="fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50 p-4 hidden">
            <div class="bg-gray-800 p-6 rounded-xl shadow-lg w-full max-w-2xl max-h-[90vh] overflow-y-auto border border-purple-700 glass-effect">
                <div class="flex justify-between items-center mb-6 border-b border-gray-700 pb-4">
                    <h2 class="text-2xl font-bold text-purple-400 flex items-center">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-users mr-2"><path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M22 21v-2a4 4 0 0 0-3-3.87"/><path d="M16 3.13a4 4 0 0 1 0 7.75"/></svg> Meus Personagens
                    </h2>
                    <button id="character-manager-close" class="text-gray-400 hover:text-white transition-colors">
                        <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-x"><path d="M18 6 6 18"/><path d="m6 6 12 12"/></svg>
                    </button>
                </div>

                <!-- Form for Adding/Editing Character -->
                <div class="mb-8 p-4 border border-gray-700 rounded-lg glass-effect">
                    <h3 id="character-form-title" class="text-xl font-semibold text-gray-200 mb-4 flex items-center">
                        <svg id="character-form-icon-edit" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-pen-square mr-2 hidden"><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/><path d="M18.37 2.63a2.12 2.12 0 1 1 3 3L12 15l-4 1 1-4Z"/></svg>
                        <svg id="character-form-icon-plus" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-plus-circle mr-2 hidden"><circle cx="12" cy="12" r="10"/><path d="M8 12h8"/><path d="M12 8v8"/></svg>
                        Adicionar Novo Personagem
                    </h3>
                    <div class="mb-4">
                        <label class="block text-gray-300 text-sm font-bold mb-2">Nome do Personagem</label>
                        <input type="text" id="new-character-name" placeholder="Ex: Capitão Estelar" class="shadow appearance-none border border-gray-600 rounded-lg w-full py-2 px-3 bg-gray-700 text-gray-100 leading-tight focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-transparent transition-all duration-200 glass-effect-input-subtle" />
                    </div>
                    <div class="mb-4">
                        <label class="block text-gray-300 text-sm font-bold mb-2">Descrição / Papel</label>
                        <textarea id="new-character-description" placeholder="Ex: Um líder corajoso, explorador de galáxias..." rows="3" class="shadow appearance-none border border-gray-600 rounded-lg w-full py-2 px-3 bg-gray-700 text-gray-100 leading-tight focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-transparent transition-all duration-200 glass-effect-input-subtle"></textarea>
                    </div>
                    <div class="mb-4">
                        <label class="block text-gray-300 text-sm font-bold mb-2">Traços Visuais</label>
                        <textarea id="new-character-visuals" placeholder="Ex: Armadura futurista azul, cabelo loiro esvoaçante, cicatriz no olho direito..." rows="3" class="shadow appearance-none border border-gray-600 rounded-lg w-full py-2 px-3 bg-gray-700 text-gray-100 leading-tight focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-transparent transition-all duration-200 glass-effect-input-subtle"></textarea>
                        <p class="text-gray-400 text-xs mt-1">Detalhes de aparência física para consistência visual.</p>
                    </div>
                    <div class="mb-4">
                        <label class="block text-gray-300 text-sm font-bold mb-2">Traços de Personalidade</label>
                        <textarea id="new-character-personality" placeholder="Ex: Determinado, sarcástico, leal, com um senso de humor seco..." rows="3" class="shadow appearance-none border border-gray-600 rounded-lg w-full py-2 px-3 bg-gray-700 text-gray-100 leading-tight focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-transparent transition-all duration-200 glass-effect-input-subtle"></textarea>
                        <p class="text-gray-400 text-xs mt-1">Características psicológicas para consistência de comportamento.</p>
                    </div>
                    <button id="save-character-button" class="mt-4 bg-purple-600 hover:bg-purple-700 text-white font-bold py-2 px-4 rounded-lg shadow-lg transition-all duration-300 transform hover:scale-105 hover:shadow-purple-500/50">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-save mr-2"><path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"/><polyline points="17 21 17 13 7 13 7 21"/><polyline points="7 3 7 8 15 8"/></svg> Salvar Personagem
                    </button>
                    <button id="cancel-edit-character-button" class="mt-4 ml-4 bg-gray-700 hover:bg-gray-600 text-gray-200 font-bold py-2 px-4 rounded-lg shadow-lg transition-all duration-300 transform hover:scale-105 hover:shadow-gray-500/50 border border-gray-600 hidden">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-x mr-2"><path d="M18 6 6 18"/><path d="m6 6 12 12"/></svg> Cancelar Edição
                    </button>
                </div>

                <!-- List of Saved Characters -->
                <h3 class="text-xl font-semibold text-gray-200 mb-4 flex items-center">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-users mr-2"><path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M22 21v-2a4 4 0 0 0-3-3.87"/><path d="M16 3.13a4 4 0 0 1 0 7.75"/></svg> Personagens Salvos (<span id="characters-count">0</span>)
                </h3>
                <div id="saved-characters-list" class="space-y-4">
                    <p id="no-characters-message" class="text-gray-400 text-center py-4">Nenhum personagem salvo ainda. Crie um acima!</p>
                    <!-- Characters will be rendered here by JS -->
                </div>
            </div>
        </div>

        <!-- Main Content -->
        <main class="container mx-auto flex-grow p-4 md:p-8">
            <div class="lg:grid lg:grid-cols-2 lg:gap-8 flex flex-col">
                <!-- Controls Panel -->
                <section class="p-6 rounded-xl shadow-lg mb-8 lg:mb-0 border border-purple-800 glass-effect">
                    <h2 class="text-2xl font-bold text-white mb-6 flex items-center">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-sparkles mr-2 text-soft-purple"><path d="M9.9 10.9c.4.8.7 1.7.6 2.7 0 1-.3 2-.8 2.8s-1.2 1.5-2.1 1.8c-1 .3-2.1.2-3.1-.2S2.4 18 2.2 17c-.2-1 .2-2.1.7-3.1s1.2-1.8 2-2.3c.9-.5 1.9-.7 3-.6 1 .1 2 .4 2.8.9Z"/><path d="M16.2 2.7c.4.8.7 1.7.6 2.7 0 1-.3 2-.8 2.8s-1.2 1.5-2.1 1.8c-1 .3-2.1.2-3.1-.2S9.6 7 9.4 6c-.2-1 .2-2.1.7-3.1s1.2-1.8 2-2.3c.9-.5 1.9-.7 3-.6 1 .1 2 .4 2.8.9Z"/><path d="M18.6 15.3c.4.8.7 1.7.6 2.7 0 1-.3 2-.8 2.8s-1.2 1.5-2.1 1.8c-1 .3-2.1.2-3.1-.2s-1.8-1.2-2-2.2c-.2-1 .2-2.1.7-3.1s1.2-1.8 2-2.3c.9-.5 1.9-.7 3-.6 1 .1 2 .4 2.8.9Z"/></svg> <span>Crie Seu Prompt de Vídeo</span> <span class="text-soft-purple">IA</span>
                    </h2>
                    <form id="main-form">
                        <div class="mb-4">
                            <label class="block text-gray-300 text-sm font-bold mb-2 flex items-center">
                                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-youtube mr-2 text-purple-400"><path d="M2.8 7.1c-.6.3-1 1.1-1 2.2V12v2.7c0 1.1.4 1.9 1 2.2L12 22l9.2-4.9c.6-.3 1-1.1 1-2.2V12v-2.7c0-1.1-.4-1.9-1-2.2L12 2 2.8 7.1Z"/><path d="m10 15 5-3-5-3v6Z"/></svg>
                                URL do Vídeo de Apresentação no Cabeçalho
                            </label>
                            <input type="text" id="form-header-media-url" placeholder="Ex: https://assets.mixkit.co/videos/preview/..." class="shadow appearance-none border border-gray-600 rounded-lg w-full py-2 px-3 bg-gray-700 text-gray-100 leading-tight focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-transparent transition-all duration-200 glass-effect-input-subtle" />
                            <p class="text-gray-400 text-xs mt-1">Cole o URL direto de um vídeo (MP4 recomendado) ou um URL de vídeo do YouTube (será usado como link).</p>
                        </div>
                        <div class="mb-4">
                            <label class="block text-gray-300 text-sm font-bold mb-2 flex items-center">
                                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-film mr-2 text-purple-400"><rect width="20" height="20" x="2" y="2" rx="2.18" ry="2.18"/><path d="M7 2v20"/><path d="M17 2v20"/><path d="M2 12h20"/><path d="M2 7h5"/><path d="M2 17h5"/><path d="M17 7h5"/><path d="M17 17h5"/></svg>
                                Estilo do Vídeo
                            </label>
                            <select id="video-style" class="shadow appearance-none border border-gray-600 rounded-lg w-full py-2 px-3 bg-gray-700 text-gray-100 leading-tight focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-transparent transition-all duration-200 glass-effect-input-subtle">
                                <option value="" disabled selected>Selecione o estilo principal...</option>
                            </select>
                        </div>
                        <div class="mb-4">
                            <label class="block text-gray-300 text-sm font-bold mb-2 flex items-center">
                                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-building mr-2 text-purple-400"><rect width="16" height="20" x="4" y="2" rx="2" ry="2"/><path d="M9.5 16h5"/><path d="M9.5 12h5"/><path d="M9.5 8h5"/></svg>
                                Tema ou Ambiente
                            </label>
                            <input type="text" id="theme" placeholder="Ex: Floresta mística ao amanhecer, metrópole cyberpunk..." class="shadow appearance-none border border-gray-600 rounded-lg w-full py-2 px-3 bg-gray-700 text-gray-100 leading-tight focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-transparent transition-all duration-200 glass-effect-input-subtle" />
                        </div>
                        <div class="mb-4">
                            <label class="block text-gray-300 text-sm font-bold mb-2 flex items-center">
                                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-edit mr-2 text-purple-400"><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/><path d="M18.37 2.63a2.12 2.12 0 1 1 3 3L12 15l-4 1 1-4Z"/></svg>
                                Narrativa / Descrição da História
                            </label>
                            <textarea id="narrative" placeholder="Descreva brevemente a ação principal ou a cena. Ex: Um explorador solitário encontra um artefato antigo..." rows="3" class="shadow appearance-none border border-gray-600 rounded-lg w-full py-2 px-3 bg-gray-700 text-gray-100 leading-tight focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-transparent transition-all duration-200 glass-effect-input-subtle"></textarea>
                            <p class="text-gray-400 text-xs mt-1">Seja conciso, mas descritivo.</p>
                        </div>
                        <div class="mb-4">
                            <label class="block text-gray-300 text-sm font-bold mb-2 flex items-center">
                                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-user mr-2 text-purple-400"><path d="M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>
                                Personagens / Figuras
                            </label>
                            <select id="characters" multiple class="shadow appearance-none border border-gray-600 rounded-lg w-full py-2 px-3 bg-gray-700 text-gray-100 leading-tight focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-transparent transition-all duration-200 h-32 overflow-y-auto glass-effect-input-subtle">
                                <option value="" disabled>Selecione personagens salvos ou crie um novo...</option>
                            </select>
                            <button type="button" id="manage-characters-button" class="mt-2 bg-gray-700 hover:bg-gray-600 text-gray-200 text-sm py-2 px-4 rounded-lg shadow-lg transition-all duration-300 hover:shadow-gray-500/50">
                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-plus-circle mr-2"><circle cx="12" cy="12" r="10"/><path d="M8 12h8"/><path d="M12 8v8"/></svg> Gerenciar Personagens
                            </button>
                        </div>

                        <div class="mb-4">
                            <label class="block text-gray-300 text-sm font-bold mb-2 flex items-center">
                                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-camera mr-2 text-purple-400"><path d="M14.5 4h-5L7 7H4a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-3l-2.5-3Z"/><circle cx="12" cy="13" r="3"/></svg>
                                Tipo de Câmera / Movimento
                            </label>
                            <select id="camera-type" class="shadow appearance-none border border-gray-600 rounded-lg w-full py-2 px-3 bg-gray-700 text-gray-100 leading-tight focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-transparent transition-all duration-200 glass-effect-input-subtle">
                                <option value="" disabled selected>Escolha o movimento da câmera...</option>
                            </select>
                        </div>
                        <div class="mb-4">
                            <label class="block text-gray-300 text-sm font-bold mb-2 flex items-center">
                                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-lightbulb mr-2 text-purple-400"><path d="M15 14c.2-1 .7-1.7 1.5-2.5 1-.9 1.5-2.2 1.5-3.5A6 6 0 0 0 6 8c0 1.3.5 2.6 1.5 3.5.8.8 1.3 1.5 1.5 2.5"/><path d="M9 18h6"/><path d="M10 22h4"/><path d="M10 18a2 2 10 0 1 1 4 0"/></svg>
                                Iluminação
                            </label>
                            <select id="lighting" class="shadow appearance-none border border-gray-600 rounded-lg w-full py-2 px-3 bg-gray-700 text-gray-100 leading-tight focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-transparent transition-all duration-200 glass-effect-input-subtle">
                                <option value="" disabled selected>Defina a atmosfera de luz...</option>
                            </select>
                        </div>
                        <div class="mb-4">
                            <label class="block text-gray-300 text-sm font-bold mb-2 flex items-center">
                                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-palette mr-2 text-purple-400"><path d="M12 2v20M17.5 5.5l-3.2 3.2M6.5 5.5l3.2 3.2M2 12h20M5.5 17.5l3.2-3.2M17.5 17.5l-3.2-3.2M12 2a10 10 0 0 1 0 20M2 12a10 10 0 0 1 20 0"/></svg>
                                Paleta de Cores
                            </label>
                            <select id="color-palette" class="shadow appearance-none border border-gray-600 rounded-lg w-full py-2 px-3 bg-gray-700 text-gray-100 leading-tight focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-transparent transition-all duration-200 glass-effect-input-subtle">
                                <option value="" disabled selected>Selecione a cor dominante ou o esquema...</option>
                            </select>
                        </div>
                        <div class="mb-4">
                            <label class="block text-gray-300 text-sm font-bold mb-2 flex items-center">
                                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-clock mr-2 text-purple-400"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>
                                Duração (segundos)
                            </label>
                            <div class="flex items-center space-x-3">
                                <input type="range" id="duration-range" min="1" max="60" step="1" value="10" class="w-full h-2 bg-gray-600 rounded-lg appearance-none cursor-pointer accent-purple-500" />
                                <input type="number" id="duration-number" value="10" min="1" max="60" class="w-20 shadow appearance-none border border-gray-600 rounded-lg py-2 px-3 bg-gray-700 text-gray-100 leading-tight focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-transparent" />
                            </div>
                        </div>
                        <div class="mb-4">
                            <label class="block text-gray-300 text-sm font-bold mb-2 flex items-center">
                                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-crop mr-2 text-purple-400"><path d="M6.13 1L1 6.13M18.37 22L22 18.37M21 15V9a2 2 0 0 0-2-2H9M3 9v6a2 2 0 0 0 2 2h6"/></svg>
                                Formato
                            </label>
                            <select id="format" class="shadow appearance-none border border-gray-600 rounded-lg w-full py-2 px-3 bg-gray-700 text-gray-100 leading-tight focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-transparent transition-all duration-200 glass-effect-input-subtle">
                                <option value="" disabled selected>Selecione a proporção do vídeo...</option>
                            </select>
                        </div>
                        <div class="mb-4">
                            <label class="block text-gray-300 text-sm font-bold mb-2 flex items-center">
                                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-sparkles mr-2 text-purple-400"><path d="M9.9 10.9c.4.8.7 1.7.6 2.7 0 1-.3 2-.8 2.8s-1.2 1.5-2.1 1.8c-1 .3-2.1.2-3.1-.2S2.4 18 2.2 17c-.2-1 .2-2.1.7-3.1s1.2-1.8 2-2.3c.9-.5 1.9-.7 3-.6 1 .1 2 .4 2.8.9Z"/><path d="M16.2 2.7c.4.8.7 1.7.6 2.7 0 1-.3 2-.8 2.8s-1.2 1.5-2.1 1.8c-1 .3-2.1.2-3.1-.2S9.6 7 9.4 6c-.2-1 .2-2.1.7-3.1s1.2-1.8 2-2.3c.9-.5 1.9-.7 3-.6 1 .1 2 .4 2.8.9Z"/><path d="M18.6 15.3c.4.8.7 1.7.6 2.7 0 1-.3 2-.8 2.8s-1.2 1.5-2.1 1.8c-1 .3-2.1.2-3.1-.2s-1.8-1.2-2-2.2c-.2-1 .2-2.1.7-3.1s1.2-1.8 2-2.3c.9-.5 1.9-.7 3-.6 1 .1 2 .4 2.8.9Z"/></svg>
                                Qualidade e Detalhes
                            </label>
                            <input type="text" id="quality" placeholder="Ex: 4K, 24fps, realismo fotorrealista, detalhes intrincados..." class="shadow appearance-none border border-gray-600 rounded-lg w-full py-2 px-3 bg-gray-700 text-gray-100 leading-tight focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-transparent transition-all duration-200 glass-effect-input-subtle" />
                            <p class="text-gray-400 text-xs mt-1">Adicione especificações técnicas ou artísticas.</p>
                        </div>
                        <div class="mb-4">
                            <label class="block text-gray-300 text-sm font-bold mb-2 flex items-center">
                                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-languages mr-2 text-purple-400"><path d="m5 8 6 6"/><path d="m4 14 6-6 2-3"/><path d="M2 5h12"/><path d="M7 2h1"/><path d="M22 22l-5-10-5 10"/><path d="M14 18h6"/></svg>
                                Idioma do Prompt Final
                            </label>
                            <select id="output-language" class="shadow appearance-none border border-gray-600 rounded-lg w-full py-2 px-3 bg-gray-700 text-gray-100 leading-tight focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-transparent transition-all duration-200 glass-effect-input-subtle">
                                <option value="" disabled selected>Selecione o idioma do prompt...</option>
                            </select>
                        </div>
                        <div class="mb-4">
                            <label class="block text-gray-300 text-sm font-bold mb-2 flex items-center">
                                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-mic mr-2 text-purple-400"><path d="M12 2a3 3 0 0 0-3 3v7a3 3 0 0 0 6 0V5a3 3 0 0 0-3-3Z"/><path d="M19 10v2a7 7 0 0 1-14 0v-2"/><line x1="12" x2="12" y1="19" y2="22"/></svg>
                                Voz / Narração
                            </label>
                            <select id="voice-narration" class="shadow appearance-none border border-gray-600 rounded-lg w-full py-2 px-3 bg-gray-700 text-gray-100 leading-tight focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-transparent transition-all duration-200 glass-effect-input-subtle">
                                <option value="" disabled selected>Selecione a voz ou narração...</option>
                            </select>
                        </div>
                    </form>
                </section>

                <!-- Prompt Preview -->
                <section class="p-6 rounded-xl shadow-lg flex flex-col border border-purple-800 glass-effect">
                    <h2 class="text-2xl font-bold text-white mb-6 flex items-center text-neon-glow">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-sparkles mr-2 text-soft-purple"><path d="M9.9 10.9c.4.8.7 1.7.6 2.7 0 1-.3 2-.8 2.8s-1.2 1.5-2.1 1.8c-1 .3-2.1.2-3.1-.2S2.4 18 2.2 17c-.2-1 .2-2.1.7-3.1s1.2-1.8 2-2.3c.9-.5 1.9-.7 3-.6 1 .1 2 .4 2.8.9Z"/><path d="M16.2 2.7c.4.8.7 1.7.6 2.7 0 1-.3 2-.8 2.8s-1.2 1.5-2.1 1.8c-1 .3-2.1.2-3.1-.2S9.6 7 9.4 6c-.2-1 .2-2.1.7-3.1s1.2-1.8 2-2.3c.9-.5 1.9-.7 3-.6 1 .1 2 .4 2.8.9Z"/><path d="M18.6 15.3c.4.8.7 1.7.6 2.7 0 1-.3 2-.8 2.8s-1.2 1.5-2.1 1.8c-1 .3-2.1.2-3.1-.2s-1.8-1.2-2-2.2c-.2-1 .2-2.1.7-3.1s1.2-1.8 2-2.3c.9-.5 1.9-.7 3-.6 1 .1 2 .4 2.8.9Z"/></svg> <span>Resultado Final do</span> <span class="text-soft-purple">Prompt</span>
                    </h2>
                    <div class="flex-grow relative">
                        <textarea id="generated-prompt" readonly class="w-full h-full min-h-[200px] bg-gray-700 text-gray-100 font-mono p-4 rounded-lg resize-none focus:outline-none border border-blue-700" placeholder="Seu prompt gerado aparecerá aqui... ou escreva o seu próprio prompt aqui no modo manual."></textarea>
                        <div id="loading-overlay" class="absolute inset-0 flex items-center justify-center bg-gray-700 bg-opacity-75 rounded-lg hidden">
                            <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-loader-2 animate-spin text-purple-400"><path d="M21 12a9 9 0 1 1-6.219-8.56"/></svg>
                        </div>
                    </div>
                    <div class="mt-6 flex flex-col sm:flex-row space-y-4 sm:space-y-0 sm:space-x-4 justify-center">
                        <button id="generate-prompt-button" class="bg-purple-600 hover:bg-purple-700 text-white font-bold py-3 px-6 rounded-lg shadow-lg transition-all duration-300 hover:shadow-purple-500/50 disabled:opacity-50 disabled:cursor-not-allowed border border-purple-500">
                            <svg id="generate-icon-sparkles" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-sparkles mr-2"><path d="M9.9 10.9c.4.8.7 1.7.6 2.7 0 1-.3 2-.8 2.8s-1.2 1.5-2.1 1.8c-1 .3-2.1.2-3.1-.2S2.4 18 2.2 17c-.2-1 .2-2.1.7-3.1s1.2-1.8 2-2.3c.9-.5 1.9-.7 3-.6 1 .1 2 .4 2.8.9Z"/><path d="M16.2 2.7c.4.8.7 1.7.6 2.7 0 1-.3 2-.8 2.8s-1.2 1.5-2.1 1.8c-1 .3-2.1.2-3.1-.2S9.6 7 9.4 6c-.2-1 .2-2.1.7-3.1s1.2-1.8 2-2.3c.9-.5 1.9-.7 3-.6 1 .1 2 .4 2.8.9Z"/><path d="M18.6 15.3c.4.8.7 1.7.6 2.7 0 1-.3 2-.8 2.8s-1.2 1.5-2.1 1.8c-1 .3-2.1.2-3.1-.2s-1.8-1.2-2-2.2c-.2-1 .2-2.1.7-3.1s1.2-1.8 2-2.3c.9-.5 1.9-.7 3-.6 1 .1 2 .4 2.8.9Z"/></svg> Gerar com IA
                        </button>
                        <button id="toggle-manual-mode-button" class="bg-gray-700 hover:bg-gray-600 text-gray-200 font-bold py-3 px-6 rounded-lg shadow-lg transition-all duration-300 hover:shadow-gray-500/50 border border-gray-600">
                            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-type mr-2"><polyline points="4 7 4 4 20 4 20 7"/><line x1="9" x2="15" y1="20" y2="20"/><line x1="12" x2="12" y1="4" y2="20"/></svg> Introduzir Manualmente
                        </button>
                        <button id="copy-prompt-button" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-6 rounded-lg shadow-lg transition-all duration-300 hover:shadow-blue-500/50 border border-blue-500">
                            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-copy mr-2"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"/><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2v2"/></svg> Copiar Prompt
                        </button>
                        <button id="reset-form-button" class="bg-gray-700 hover:bg-gray-600 text-gray-200 font-bold py-3 px-6 rounded-lg shadow-lg transition-all duration-300 hover:shadow-gray-500/50 border border-gray-600">
                            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-rotate-ccw mr-2"><path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"/><path d="M3 3v5h5"/></svg> Limpar Campos
                        </button>
                        <button id="save-prompt-button" class="bg-emerald-600 hover:bg-emerald-700 text-white font-bold py-3 px-6 rounded-lg shadow-lg transition-all duration-300 hover:shadow-emerald-500/50 border border-emerald-500">
                            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-save mr-2"><path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"/><polyline points="17 21 17 13 7 13 7 21"/><polyline points="7 3 7 8 15 8"/></svg> Salvar Prompt
                        </button>
                    </div>
                </section>
            </div>

            <!-- YouTube Videos Section -->
            <section class="p-6 rounded-xl shadow-lg mt-8 border border-purple-800 glass-effect">
                <h2 class="text-2xl font-bold text-white mb-6 flex items-center text-neon-glow">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-youtube mr-2 text-soft-purple"><path d="M2.8 7.1c-.6.3-1 1.1-1 2.2V12v2.7c0 1.1.4 1.9 1 2.2L12 22l9.2-4.9c.6-.3 1-1.1 1-2.2V12v-2.7c0-1.1-.4-1.9-1-2.2L12 2 2.8 7.1Z"/><path d="m10 15 5-3-5-3v6Z"/></svg> <span>Visualizador de Vídeos</span> <span class="text-soft-purple">YouTube</span>
                </h2>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div>
                        <div class="mb-4">
                            <label class="block text-gray-300 text-sm font-bold mb-2">ID do Vídeo YouTube 1</label>
                            <input type="text" id="youtube-video-id-1" placeholder="Ex: dQw4w9WgXcQ" class="shadow appearance-none border border-gray-600 rounded-lg w-full py-2 px-3 bg-gray-700 text-gray-100 leading-tight focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-transparent transition-all duration-200 glass-effect-input-subtle" />
                            <p class="text-gray-400 text-xs mt-1">Cole apenas o ID do vídeo (a parte final do URL).</p>
                        </div>
                        <div id="youtube-player-1" class="relative w-full overflow-hidden rounded-lg shadow-lg border border-gray-700" style="padding-top: 56.25%; display: none;">
                            <iframe class="absolute top-0 left-0 w-full h-full" src="" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen title="YouTube video player 1"></iframe>
                        </div>
                    </div>
                    <div>
                        <div class="mb-4">
                            <label class="block text-gray-300 text-sm font-bold mb-2">ID do Vídeo YouTube 2</label>
                            <input type="text" id="youtube-video-id-2" placeholder="Ex: dQw4w9WgXcQ" class="shadow appearance-none border border-gray-600 rounded-lg w-full py-2 px-3 bg-gray-700 text-gray-100 leading-tight focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-transparent transition-all duration-200 glass-effect-input-subtle" />
                        </div>
                        <div id="youtube-player-2" class="relative w-full overflow-hidden rounded-lg shadow-lg border border-gray-700" style="padding-top: 56.25%; display: none;">
                            <iframe class="absolute top-0 left-0 w-full h-full" src="" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen title="YouTube video player 2"></iframe>
                        </div>
                    </div>
                    <div>
                        <div class="mb-4">
                            <label class="block text-gray-300 text-sm font-bold mb-2">ID do Vídeo YouTube 3</label>
                            <input type="text" id="youtube-video-id-3" placeholder="Ex: dQw4w9WgXcQ" class="shadow appearance-none border border-gray-600 rounded-lg w-full py-2 px-3 bg-gray-700 text-gray-100 leading-tight focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-transparent transition-all duration-200 glass-effect-input-subtle" />
                        </div>
                        <div id="youtube-player-3" class="relative w-full overflow-hidden rounded-lg shadow-lg border border-gray-700" style="padding-top: 56.25%; display: none;">
                            <iframe class="absolute top-0 left-0 w-full h-full" src="" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen title="YouTube video player 3"></iframe>
                        </div>
                    </div>
                    <div>
                        <div class="mb-4">
                            <label class="block text-gray-300 text-sm font-bold mb-2">ID do Vídeo YouTube 4</label>
                            <input type="text" id="youtube-video-id-4" placeholder="Ex: dQw4w9WgXcQ" class="shadow appearance-none border border-gray-600 rounded-lg w-full py-2 px-3 bg-gray-700 text-gray-100 leading-tight focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-transparent transition-all duration-200 glass-effect-input-subtle" />
                        </div>
                        <div id="youtube-player-4" class="relative w-full overflow-hidden rounded-lg shadow-lg border border-gray-700" style="padding-top: 56.25%; display: none;">
                            <iframe class="absolute top-0 left-0 w-full h-full" src="" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen title="YouTube video player 4"></iframe>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Prompt History Section -->
            <section id="prompt-history-section" class="p-6 rounded-xl shadow-lg mt-8 border border-purple-800 glass-effect hidden">
                <h2 class="text-2xl font-bold text-white mb-6 flex items-center text-neon-glow">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-history mr-2 text-soft-purple"><path d="M21 12a9 9 0 1 1-9-9c2.52 0 4.93 1 6.74 2.74L21 8"/><path d="M21 3v5h-5"/><path d="M12 7v6h4"/></svg> <span>Seu Histórico de</span> <span class="text-soft-purple">Prompts</span>
                </h2>
                <div id="user-prompts-list" class="space-y-4">
                    <!-- Prompts will be rendered here by JS -->
                </div>
            </section>
        </main>

        <!-- Footer - User ID -->
        <footer class="bg-gray-900 p-4 text-center text-gray-400 text-sm border-t-2 border-purple-700 glass-effect">
            <span id="user-id-display"></span>
        </footer>
    </div>

    <!-- Firebase SDKs -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
        import { getAuth, signInAnonymously, signInWithCustomToken, onAuthStateChanged, createUserWithEmailAndPassword, signInWithEmailAndPassword, signOut, GoogleAuthProvider, signInWithPopup } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
        import { getFirestore, collection, addDoc, query, onSnapshot, orderBy, doc, getDoc, setDoc, updateDoc, deleteDoc } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

        // Global variables from Canvas environment (will be undefined outside Canvas)
        const canvasAppId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
        const canvasFirebaseConfig = typeof __firebase_config !== 'undefined' ? JSON.parse(__firebase_config) : {};
        const canvasInitialAuthToken = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : null;

        // --- SEU CÓDIGO DE CONFIGURAÇÃO FIREBASE REAL AQUI ---
        // Para usar seu aplicativo fora do Canvas, você PRECISA substituir o 'null' abaixo
        // pela sua configuração Firebase REAL.
        // Exemplo:
        // const myFirebaseConfig = {
        //   apiKey: "YOUR_API_KEY",
        //   authDomain: "YOUR_AUTH_DOMAIN",
        //   projectId: "YOUR_PROJECT_ID",
        //   storageBucket: "YOUR_STORAGE_BUCKET",
        //   messagingSenderId: "YOUR_MESSAGING_SENDER_ID",
        //   appId: "YOUR_APP_ID"
        // };
        const myFirebaseConfig = null; // <-- SUBSTITUA ISSO PELA SUA CONFIGURAÇÃO REAL

        // Determine which config to use
        const firebaseConfig = myFirebaseConfig || canvasFirebaseConfig;
        const appId = myFirebaseConfig ? myFirebaseConfig.projectId : canvasAppId; // Use projectId as appId if custom config is provided

        // Firebase initialization
        let app;
        let db;
        let auth;
        let currentUserId = null;
        let currentUserEmail = '';
        let currentUserCPF = '';
        let isAuthReady = false;
        let userPrompts = [];
        let userCharacters = [];
        let editingCharacter = null;
        let isManualInputMode = false; // State for AI vs Manual mode

        try {
            if (firebaseConfig && Object.keys(firebaseConfig).length > 0) {
                app = initializeApp(firebaseConfig);
                db = getFirestore(app);
                auth = getAuth(app);
            } else {
                console.error("Firebase configuration is missing or empty. Please provide your Firebase config.");
                showFeedback('error', 'Configuração do Firebase ausente. O aplicativo pode não funcionar corretamente.');
            }
        } catch (error) {
            console.error("Erro ao inicializar o Firebase:", error);
            showFeedback('error', 'Erro ao inicializar o Firebase. Verifique a configuração.');
        }

        // --- Static options for select fields ---
        const videoStyleOptions = ['Realista', 'Anime', 'Cinematográfico', 'Futurista', 'Documentário', 'Animação 2D', 'Stop Motion', 'VFX'];
        const cameraTypeOptions = ['Travelling lento', 'Drone sobrevoando', 'POV (Ponto de Vista)', 'Plano sequência', 'Zoom in/out', 'Câmara fixa', 'Handheld', 'Panorâmica', 'Tilt'];
        const lightingOptions = ['Luz natural dourada', 'Neon vibrante', 'Sombra dramática', 'Luz suave difusa', 'Flash estroboscópico', 'Luz de velas', 'Contraluz', 'Luz ambiente'];
        const colorPaletteOptions = ['Tons pastéis', 'Cores vibrantes', 'Monocromático', 'Cores quentes', 'Cores frias', 'Sépia', 'Preto e Branco', 'Cores Complementares'];
        const formatOptions = ['16:9 (Paisagem)', '9:16 (Vertical/TikTok)', '1:1 (Quadrado)', '4:3 (Clássico)'];
        const outputLanguageOptions = ['portuguese', 'english'];
        const voiceNarrationOptions = ['Voz Brasileira (Português do Brasil)', 'Voz Masculina Padrão', 'Voz Feminina Padrão', 'Narrador Robótico', 'Sem Narração'];

        // DOM Elements
        const entryPage = document.getElementById('entry-page');
        const mainApp = document.getElementById('main-app');
        const enterPlatformButton = document.getElementById('enter-platform-button');

        const headerMediaVideo = document.getElementById('header-media-video');
        const headerMediaUrlInput = document.getElementById('header-media-url-input');
        const entryPageVideo = document.getElementById('entry-page-video');

        const sidebar = document.getElementById('mobile-sidebar');
        const sidebarToggle = document.getElementById('sidebar-toggle');
        const sidebarCloseButton = document.getElementById('sidebar-close-button');
        const menuIcon = document.getElementById('menu-icon');
        const xIcon = document.getElementById('x-icon');

        const feedbackMessageDiv = document.getElementById('feedback-message');
        const feedbackTextSpan = document.getElementById('feedback-text');
        const feedbackIconSuccess = document.getElementById('feedback-icon-success');
        const feedbackIconError = document.getElementById('feedback-icon-error');

        const authModal = document.getElementById('auth-modal');
        const authModalCloseButton = document.getElementById('auth-modal-close');
        const authModalTitle = document.getElementById('auth-modal-title');
        const authIconUserPlus = document.getElementById('auth-icon-user-plus');
        const authIconLogIn = document.getElementById('auth-icon-log-in');
        const authForm = document.getElementById('auth-form');
        const authEmailInput = document.getElementById('auth-email');
        const authPasswordInput = document.getElementById('auth-password');
        const authSubmitButton = document.getElementById('auth-submit-button');
        const authToggleText = document.getElementById('auth-toggle-text');
        const authToggleButton = document.getElementById('auth-toggle-button');
        const googleSignInButton = document.getElementById('google-sign-in-button');
        const authButtonsDesktop = document.getElementById('auth-buttons-desktop');
        const authButtonsMobile = document.getElementById('auth-buttons-mobile');

        const profileModal = document.getElementById('profile-modal');
        const profileModalCloseButton = document.getElementById('profile-modal-close');
        const profileEmailDisplay = document.getElementById('profile-email');
        const profileCPFInput = document.getElementById('profile-cpf');
        const saveProfileButton = document.getElementById('save-profile-button');

        const plansModal = document.getElementById('plans-modal');
        const plansModalCloseButton = document.getElementById('plans-modal-close');
        const plansButtonDesktop = document.getElementById('plans-button-desktop');
        const plansButtonMobile = document.getElementById('plans-button-mobile');

        const characterManagerModal = document.getElementById('character-manager-modal');
        const characterManagerCloseButton = document.getElementById('character-manager-close');
        const manageCharactersButton = document.getElementById('manage-characters-button');
        const myCharactersButtonDesktop = document.getElementById('my-characters-button-desktop');
        const myCharactersButtonMobile = document.getElementById('my-characters-button-mobile');
        const newCharacterNameInput = document.getElementById('new-character-name');
        const newCharacterDescriptionInput = document.getElementById('new-character-description');
        const newCharacterVisualsInput = document.getElementById('new-character-visuals');
        const newCharacterPersonalityInput = document.getElementById('new-character-personality');
        const saveCharacterButton = document.getElementById('save-character-button');
        const cancelEditCharacterButton = document.getElementById('cancel-edit-character-button');
        const characterFormTitle = document.getElementById('character-form-title');
        const characterFormIconEdit = document.getElementById('character-form-icon-edit');
        const characterFormIconPlus = document.getElementById('character-form-icon-plus');
        const savedCharactersList = document.getElementById('saved-characters-list');
        const noCharactersMessage = document.getElementById('no-characters-message');
        const charactersCountSpan = document.getElementById('characters-count');

        const videoStyleSelect = document.getElementById('video-style');
        const themeInput = document.getElementById('theme');
        const narrativeTextarea = document.getElementById('narrative');
        const charactersMultiSelect = document.getElementById('characters');
        const cameraTypeSelect = document.getElementById('camera-type');
        const lightingSelect = document.getElementById('lighting');
        const colorPaletteSelect = document.getElementById('color-palette');
        const durationRange = document.getElementById('duration-range');
        const durationNumber = document.getElementById('duration-number');
        const formatSelect = document.getElementById('format');
        const qualityInput = document.getElementById('quality');
        const outputLanguageSelect = document.getElementById('output-language');
        const voiceNarrationSelect = document.getElementById('voice-narration');

        const generatedPromptTextarea = document.getElementById('generated-prompt');
        const loadingOverlay = document.getElementById('loading-overlay');
        const generatePromptButton = document.getElementById('generate-prompt-button');
        const toggleManualModeButton = document.getElementById('toggle-manual-mode-button');
        const copyPromptButton = document.getElementById('copy-prompt-button');
        const resetFormButton = document.getElementById('reset-form-button');
        const savePromptButton = document.getElementById('save-prompt-button');

        const youtubeVideoId1Input = document.getElementById('youtube-video-id-1');
        const youtubePlayer1 = document.getElementById('youtube-player-1');
        const youtubeVideoId2Input = document.getElementById('youtube-video-id-2');
        const youtubePlayer2 = document.getElementById('youtube-player-2');
        const youtubeVideoId3Input = document.getElementById('youtube-video-id-3');
        const youtubePlayer3 = document.getElementById('youtube-player-3');
        const youtubeVideoId4Input = document.getElementById('youtube-video-id-4');
        const youtubePlayer4 = document.getElementById('youtube-player-4');

        const promptHistorySection = document.getElementById('prompt-history-section');
        const userPromptsList = document.getElementById('user-prompts-list');
        const userIdDisplay = document.getElementById('user-id-display');

        // --- State Management (using global variables and DOM updates) ---
        let showEntryPage = true;
        let showCopiedMessage = false;
        let isSidebarOpen = false;
        let isLoadingPrompt = false;
        let feedbackTimeoutId = null;
        let showAuthModal = false;
        let isRegisterMode = false;
        let showProfileModal = false;
        let showPlansModal = false;
        let isCharacterManagerOpen = false;

        // --- Helper Functions ---

        function showFeedback(type, text) {
            if (feedbackTimeoutId) {
                clearTimeout(feedbackTimeoutId);
            }
            feedbackMessageDiv.classList.remove('hidden', 'bg-green-600', 'bg-red-600');
            feedbackIconSuccess.classList.add('hidden');
            feedbackIconError.classList.add('hidden');

            if (type === 'success') {
                feedbackMessageDiv.classList.add('bg-green-600');
                feedbackIconSuccess.classList.remove('hidden');
            } else if (type === 'error') {
                feedbackMessageDiv.classList.add('bg-red-600');
                feedbackIconError.classList.remove('hidden');
            }
            feedbackTextSpan.textContent = text;
            feedbackTimeoutId = setTimeout(() => {
                feedbackMessageDiv.classList.add('hidden');
            }, 3000);
        }

        function updateAuthUI() {
            authButtonsDesktop.innerHTML = '';
            authButtonsMobile.innerHTML = '';

            if (currentUserId && auth.currentUser && !auth.currentUser.isAnonymous) {
                // Logged in state
                authButtonsDesktop.innerHTML = `
                    <button id="profile-button-desktop" class="text-gray-300 hover:text-purple-400 transition-colors duration-200 flex items-center group relative">
                        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-user-circle mr-1"><circle cx="12" cy="12" r="10"/><circle cx="12" cy="10" r="3"/><path d="M7 20.662V19a2 2 0 0 1 2-2h6a2 2 0 0 1 2 2v1.662"/></svg> Meu Perfil
                        <span class="absolute bottom-0 left-0 w-full h-0.5 bg-purple-500 scale-x-0 group-hover:scale-x-100 transition-transform duration-300"></span>
                    </button>
                    <button id="logout-button-desktop" class="text-gray-300 hover:text-red-400 transition-colors duration-200 flex items-center group relative">
                        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-log-out mr-1"><path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/><polyline points="17 17 22 12 17 7"/><line x1="22" x2="10" y1="12" y2="12"/></svg> Sair
                        <span class="absolute bottom-0 left-0 w-full h-0.5 bg-red-500 scale-x-0 group-hover:scale-x-100 transition-transform duration-300"></span>
                    </button>
                `;
                authButtonsMobile.innerHTML = `
                    <button id="profile-button-mobile" class="text-gray-300 hover:text-purple-400 transition-colors duration-200 flex items-center w-full text-left sidebar-link">
                        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-user-circle mr-2"><circle cx="12" cy="12" r="10"/><circle cx="12" cy="10" r="3"/><path d="M7 20.662V19a2 2 0 0 1 2-2h6a2 2 0 0 1 2 2v1.662"/></svg> Meu Perfil
                    </button>
                    <button id="logout-button-mobile" class="text-gray-300 hover:text-red-400 transition-colors duration-200 flex items-center w-full text-left sidebar-link">
                        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-log-out mr-2"><path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/><polyline points="17 17 22 12 17 7"/><line x1="22" x2="10" y1="12" y2="12"/></svg> Sair
                    </button>
                `;
                document.getElementById('profile-button-desktop').addEventListener('click', () => { showProfileModal = true; renderModals(); });
                document.getElementById('logout-button-desktop').addEventListener('click', handleLogout);
                document.getElementById('profile-button-mobile').addEventListener('click', () => { showProfileModal = true; isSidebarOpen = false; renderSidebar(); renderModals(); });
                document.getElementById('logout-button-mobile').addEventListener('click', () => { handleLogout(); isSidebarOpen = false; renderSidebar(); });
            } else {
                // Logged out / Anonymous state
                authButtonsDesktop.innerHTML = `
                    <button id="login-register-button-desktop" class="text-gray-300 hover:text-purple-400 transition-colors duration-200 flex items-center group relative">
                        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-log-in mr-1"><path d="M15 3h4a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2h-4"/><polyline points="10 17 15 12 10 7"/><line x1="15" x2="3" y1="12" y2="12"/></svg> Login / Cadastro
                        <span class="absolute bottom-0 left-0 w-full h-0.5 bg-purple-500 scale-x-0 group-hover:scale-x-100 transition-transform duration-300"></span>
                    </button>
                `;
                authButtonsMobile.innerHTML = `
                    <button id="login-register-button-mobile" class="text-gray-300 hover:text-purple-400 transition-colors duration-200 flex items-center w-full text-left sidebar-link">
                        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-log-in mr-2"><path d="M15 3h4a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2h-4"/><polyline points="10 17 15 12 10 7"/><line x1="15" x2="3" y1="12" y2="12"/></svg> Login / Cadastro
                    </button>
                `;
                document.getElementById('login-register-button-desktop').addEventListener('click', () => { showAuthModal = true; isRegisterMode = false; renderModals(); });
                document.getElementById('login-register-button-mobile').addEventListener('click', () => { showAuthModal = true; isRegisterMode = false; isSidebarOpen = false; renderSidebar(); renderModals(); });
            }
            userIdDisplay.textContent = currentUserId ? `ID do Usuário: ${currentUserId}` : 'Usuário Anónimo';
        }

        function renderSidebar() {
            if (isSidebarOpen) {
                sidebar.classList.remove('translate-x-full');
                menuIcon.classList.add('hidden');
                xIcon.classList.remove('hidden');
            } else {
                sidebar.classList.add('translate-x-full');
                menuIcon.classList.remove('hidden');
                xIcon.classList.add('hidden');
            }
        }

        function renderModals() {
            authModal.classList.toggle('hidden', !showAuthModal);
            profileModal.classList.toggle('hidden', !showProfileModal);
            plansModal.classList.toggle('hidden', !showPlansModal);
            characterManagerModal.classList.toggle('hidden', !isCharacterManagerOpen);

            if (showAuthModal) {
                authModalTitle.textContent = isRegisterMode ? 'Registrar' : 'Login';
                authIconUserPlus.classList.toggle('hidden', !isRegisterMode);
                authIconLogIn.classList.toggle('hidden', isRegisterMode);
                authSubmitButton.textContent = isRegisterMode ? 'Registrar' : 'Entrar';
                authToggleText.innerHTML = isRegisterMode ? 'Já tem uma conta? <button id="auth-toggle-button-inner" class="text-blue-400 hover:underline">Faça Login</button>' : 'Não tem uma conta? <button id="auth-toggle-button-inner" class="text-blue-400 hover:underline">Cadastre-se</button>';
                document.getElementById('auth-toggle-button-inner').addEventListener('click', () => {
                    isRegisterMode = !isRegisterMode;
                    renderModals(); // Re-render to update title and button text
                });
            }
            if (showProfileModal) {
                profileEmailDisplay.textContent = currentUserEmail;
                profileCPFInput.value = currentUserCPF;
            }
            if (isCharacterManagerOpen) {
                characterFormTitle.textContent = editingCharacter ? `Editar Personagem: ${editingCharacter.name}` : 'Adicionar Novo Personagem';
                characterFormIconEdit.classList.toggle('hidden', !editingCharacter);
                characterFormIconPlus.classList.toggle('hidden', !!editingCharacter);
                saveCharacterButton.innerHTML = `<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-save mr-2"><path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"/><polyline points="17 21 17 13 7 13 7 21"/><polyline points="7 3 7 8 15 8"/></svg> ${editingCharacter ? 'Atualizar Personagem' : 'Salvar Personagem'}`;
                cancelEditCharacterButton.classList.toggle('hidden', !editingCharacter);

                newCharacterNameInput.value = editingCharacter ? editingCharacter.name : '';
                newCharacterDescriptionInput.value = editingCharacter ? editingCharacter.description : '';
                newCharacterVisualsInput.value = editingCharacter ? editingCharacter.visualTraits : '';
                newCharacterPersonalityInput.value = editingCharacter ? editingCharacter.personalityTraits : '';
                renderCharactersList();
            }
        }

        function populateSelect(selectElement, optionsArray, selectedValue = '') {
            selectElement.innerHTML = `<option value="" disabled ${selectedValue === '' ? 'selected' : ''}>${selectElement.querySelector('option').textContent}</option>`;
            optionsArray.forEach(option => {
                const optionElement = document.createElement('option');
                optionElement.value = option;
                optionElement.textContent = option;
                if (option === selectedValue) {
                    optionElement.selected = true;
                }
                selectElement.appendChild(optionElement);
            });
        }

        function populateCharactersMultiSelect() {
            charactersMultiSelect.innerHTML = '';
            if (userCharacters.length === 0) {
                const optionElement = document.createElement('option');
                optionElement.value = "";
                optionElement.disabled = true;
                optionElement.selected = true;
                optionElement.textContent = "Nenhum personagem guardado. Crie um!";
                charactersMultiSelect.appendChild(optionElement);
            } else {
                userCharacters.forEach(character => {
                    const optionElement = document.createElement('option');
                    optionElement.value = character.id;
                    optionElement.textContent = character.name;
                    if (Array.isArray(charactersMultiSelect.selectedOptions) && Array.from(charactersMultiSelect.selectedOptions).map(opt => opt.value).includes(character.id)) {
                        optionElement.selected = true;
                    }
                    charactersMultiSelect.appendChild(optionElement);
                });
            }
        }

        function updateHeaderMedia(url) {
            if (url.includes('youtube.com/watch?v=') || url.includes('youtu.be/')) {
                const videoId = getYouTubeVideoId(url);
                if (videoId) {
                    headerMediaVideo.style.display = 'none';
                    document.getElementById('header-media-fallback').style.display = 'flex';
                    document.getElementById('header-media-fallback').innerHTML = `
                        <iframe
                            class="absolute top-0 left-0 w-full h-full"
                            src="https://www.youtube.com/embed/${videoId}?autoplay=1&mute=1&loop=1&playlist=${videoId}&controls=0"
                            frameborder="0"
                            allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
                            allowfullscreen
                            title="YouTube video player"
                        ></iframe>
                    `;
                } else {
                    headerMediaVideo.style.display = 'none';
                    document.getElementById('header-media-fallback').style.display = 'flex';
                    document.getElementById('header-media-fallback').textContent = 'URL do YouTube inválido.';
                }
            } else {
                headerMediaVideo.src = url;
                headerMediaVideo.style.display = 'block';
                document.getElementById('header-media-fallback').style.display = 'none';
                headerMediaVideo.onerror = () => {
                    headerMediaVideo.style.display = 'none';
                    document.getElementById('header-media-fallback').style.display = 'flex';
                    document.getElementById('header-media-fallback').textContent = 'Erro ao carregar o vídeo de apresentação. Verifique o URL.';
                };
            }
        }

        function getYouTubeVideoId(url) {
            let videoId = '';
            const youtubeRegex = /(?:youtube\.com\/(?:[^\/]+\/.+\/|(?:v|e(?:mbed)?)\/|.*[?&]v=)|youtu\.be\/)([^"&?\/\s]{11})/i;
            const match = url.match(youtubeRegex);
            if (match && match[1]) {
                videoId = match[1];
            }
            return videoId;
        }

        function renderYouTubePlayer(inputId, playerDivId) {
            const inputElement = document.getElementById(inputId);
            const playerDiv = document.getElementById(playerDivId);
            const videoId = inputElement.value;

            if (videoId) {
                playerDiv.style.display = 'block';
                playerDiv.querySelector('iframe').src = `https://www.youtube.com/embed/${videoId}`;
            } else {
                playerDiv.style.display = 'none';
                playerDiv.querySelector('iframe').src = '';
            }
        }

        // --- Firebase Functions ---

        async function handleAuthStateChanged(user) {
            if (user) {
                currentUserId = user.uid;
                currentUserEmail = user.email || 'N/A';
                if (db) { // Ensure db is initialized before accessing Firestore
                    const userDocRef = doc(db, `artifacts/${appId}/users/${user.uid}/profile/data`);
                    const userDocSnap = await getDoc(userDocRef);
                    if (userDocSnap.exists()) {
                        currentUserCPF = userDocSnap.data().cpf || '';
                    } else {
                        currentUserCPF = '';
                    }
                }
            } else {
                currentUserId = null;
                currentUserEmail = '';
                currentUserCPF = '';
                try {
                    // Try to sign in anonymously if no custom token from Canvas
                    if (auth) { // Ensure auth is initialized
                        await signInAnonymously(auth);
                        currentUserId = auth.currentUser?.uid;
                        currentUserEmail = auth.currentUser?.email || 'Anónimo';
                    }
                } catch (error) {
                    console.error("Erro na autenticação Firebase inicial:", error);
                    currentUserId = crypto.randomUUID(); // Fallback for failed anonymous sign-in
                    currentUserEmail = 'Anónimo (Erro de Autenticação)';
                    showFeedback('error', 'Falha na autenticação inicial. Você pode continuar como anônimo, mas o salvamento pode não funcionar.');
                }
            }
            isAuthReady = true;
            updateAuthUI();
            setupFirestoreListeners();
        }

        function setupFirestoreListeners() {
            if (isAuthReady && currentUserId && db) { // Ensure db is initialized
                // Listen for Prompts
                const promptsCollectionRef = collection(db, `artifacts/${appId}/users/${currentUserId}/prompts`);
                const qPrompts = query(promptsCollectionRef, orderBy('createdAt', 'desc'));
                onSnapshot(qPrompts, (snapshot) => {
                    userPrompts = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                    renderUserPrompts();
                }, (error) => {
                    console.error("Erro ao buscar prompts:", error);
                    showFeedback('error', 'Erro ao carregar o seu histórico de prompts.');
                });

                // Listen for Characters
                const charactersCollectionRef = collection(db, `artifacts/${appId}/users/${currentUserId}/characters`);
                const qCharacters = query(charactersCollectionRef, orderBy('name', 'asc'));
                onSnapshot(qCharacters, (snapshot) => {
                    const newCharactersData = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                    // Only update if data has changed to prevent unnecessary re-renders
                    if (JSON.stringify(newCharactersData) !== JSON.stringify(userCharacters)) {
                        userCharacters = newCharactersData;
                        populateCharactersMultiSelect();
                        renderCharactersList();
                    }
                }, (error) => {
                    console.error("Erro ao buscar personagens:", error);
                    showFeedback('error', 'Erro ao carregar os seus personagens.');
                });
            }
        }

        async function handleRegister() {
            try {
                const email = authEmailInput.value;
                const password = authPasswordInput.value;
                const userCredential = await createUserWithEmailAndPassword(auth, email, password);
                const user = userCredential.user;
                await setDoc(doc(db, `artifacts/${appId}/users/${user.uid}/profile/data`), {
                    email: user.email,
                    createdAt: new Date(),
                    cpf: ''
                });
                showFeedback('success', 'Registo concluído com sucesso! Está com sessão iniciada.');
                showAuthModal = false;
                renderModals();
            } catch (error) {
                showFeedback('error', `Erro no registo: ${error.message}`);
                console.error("Erro no registo:", error);
            }
        }

        async function handleLogin() {
            try {
                const email = authEmailInput.value;
                const password = authPasswordInput.value;
                await signInWithEmailAndPassword(auth, email, password);
                showFeedback('success', 'Sessão iniciada com sucesso!');
                showAuthModal = false;
                renderModals();
            } catch (error) {
                showFeedback('error', `Erro ao iniciar sessão: ${error.message}`);
                console.error("Erro ao iniciar sessão:", error);
            }
        }

        async function handleGoogleSignIn() {
            try {
                const provider = new GoogleAuthProvider();
                const userCredential = await signInWithPopup(auth, provider);
                const user = userCredential.user;
                const userDocRef = doc(db, `artifacts/${appId}/users/${user.uid}/profile/data`);
                const userDocSnap = await getDoc(userDocRef);
                if (!userDocSnap.exists()) {
                    await setDoc(userDocRef, {
                        email: user.email,
                        createdAt: new Date(),
                        cpf: ''
                    });
                }
                showFeedback('success', 'Sessão iniciada com Google com sucesso!');
                showAuthModal = false;
                renderModals();
            } catch (error) {
                showFeedback('error', `Erro ao iniciar sessão com Google: ${error.message}`);
                console.error("Erro ao iniciar sessão com Google:", error);
            }
        }

        async function handleLogout() {
            try {
                await signOut(auth);
                showFeedback('success', 'Sessão terminada com sucesso!');
                // Sign in anonymously after logout to maintain a session
                await signInAnonymously(auth);
            } catch (error) {
                showFeedback('error', `Erro ao terminar sessão: ${error.message}`);
                console.error("Erro ao terminar sessão:", error);
            }
        }

        async function handleSaveProfile() {
            if (!currentUserId) {
                showFeedback('error', "Utilizador não autenticado.");
                return;
            }
            try {
                const userDocRef = doc(db, `artifacts/${appId}/users/${currentUserId}/profile/data`);
                await setDoc(userDocRef, {
                    email: currentUserEmail, // Email is read-only from auth
                    cpf: profileCPFInput.value,
                    updatedAt: new Date()
                }, { merge: true });
                currentUserCPF = profileCPFInput.value; // Update local state
                showFeedback('success', 'Perfil atualizado com sucesso!');
                showProfileModal = false;
                renderModals();
            } catch (error) {
                showFeedback('error', `Erro ao guardar perfil: ${error.message}`);
                console.error("Erro ao guardar perfil:", error);
            }
        }

        async function handleSaveCharacter() {
            if (!currentUserId || auth.currentUser.isAnonymous) {
                showFeedback('error', "Por favor, inicie sessão para guardar personagens.");
                return;
            }
            const name = newCharacterNameInput.value.trim();
            if (!name) {
                showFeedback('error', "O nome do personagem é obrigatório.");
                return;
            }

            try {
                const charactersCollectionRef = collection(db, `artifacts/${appId}/users/${currentUserId}/characters`);
                if (editingCharacter) {
                    const charDocRef = doc(db, charactersCollectionRef.path, editingCharacter.id);
                    await updateDoc(charDocRef, {
                        name: name,
                        description: newCharacterDescriptionInput.value,
                        visualTraits: newCharacterVisualsInput.value,
                        personalityTraits: newCharacterPersonalityInput.value,
                        updatedAt: new Date()
                    });
                    showFeedback('success', `Personagem "${name}" atualizado!`);
                } else {
                    await addDoc(charactersCollectionRef, {
                        name: name,
                        description: newCharacterDescriptionInput.value,
                        visualTraits: newCharacterVisualsInput.value,
                        personalityTraits: newCharacterPersonalityInput.value,
                        createdAt: new Date()
                    });
                    showFeedback('success', `Personagem "${name}" guardado!`);
                }
                // Reset form and editing state
                newCharacterNameInput.value = '';
                newCharacterDescriptionInput.value = '';
                newCharacterVisualsInput.value = '';
                newCharacterPersonalityInput.value = '';
                editingCharacter = null;
                renderModals(); // Re-render character manager to update list/form
            } catch (error) {
                console.error("Erro ao guardar personagem:", error);
                showFeedback('error', "Erro ao guardar personagem. Tente novamente.");
            }
        }

        function handleEditCharacter(character) {
            editingCharacter = character;
            newCharacterNameInput.value = character.name;
            newCharacterDescriptionInput.value = character.description;
            newCharacterVisualsInput.value = character.visualTraits;
            newCharacterPersonalityInput.value = character.personalityTraits;
            renderModals(); // Re-render character manager to show edit form
        }

        async function handleDeleteCharacter(charId, charName) {
            if (!currentUserId || auth.currentUser.isAnonymous) {
                showFeedback('error', "Por favor, inicie sessão para excluir personagens.");
                return;
            }
            // In a real app, use a custom modal for confirmation. For this example, proceed directly.
            if (true) {
                try {
                    const charDocRef = doc(db, `artifacts/${appId}/users/${currentUserId}/characters`, charId);
                    await deleteDoc(charDocRef);
                    showFeedback('success', `Personagem "${charName}" excluído!`);
                } catch (error) {
                    console.error("Erro ao excluir personagem:", error);
                    showFeedback('error', "Erro ao excluir personagem. Tente novamente.");
                }
            }
        }

        function renderCharactersList() {
            savedCharactersList.innerHTML = '';
            if (userCharacters.length === 0) {
                noCharactersMessage.style.display = 'block';
            } else {
                noCharactersMessage.style.display = 'none';
                userCharacters.forEach(char => {
                    const charDiv = document.createElement('div');
                    charDiv.className = 'bg-gray-700 p-4 rounded-lg shadow-md flex justify-between items-center border border-gray-600 hover:border-blue-500 transition-colors duration-200 glass-effect';
                    charDiv.innerHTML = `
                        <div>
                            <p class="font-bold text-lg text-purple-300">${char.name}</p>
                            ${char.description ? `<p class="text-sm text-gray-300 mt-1">${char.description}</p>` : ''}
                            ${char.visualTraits ? `<p class="text-xs text-gray-400 mt-1">Visuais: ${char.visualTraits}</p>` : ''}
                            ${char.personalityTraits ? `<p class="text-xs text-gray-400 mt-1">Personalidade: ${char.personalityTraits}</p>` : ''}
                        </div>
                        <div class="flex space-x-2">
                            <button class="edit-character-button p-2 rounded-full bg-blue-600 hover:bg-blue-700 text-white transition-all duration-300 transform hover:scale-110 hover:shadow-blue-500/50" title="Editar" data-char-id="${char.id}">
                                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-pen-square"><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/><path d="M18.37 2.63a2.12 2.12 0 1 1 3 3L12 15l-4 1 1-4Z"/></svg>
                            </button>
                            <button class="delete-character-button p-2 rounded-full bg-red-600 hover:bg-red-700 text-white transition-all duration-300 transform hover:scale-110 hover:shadow-red-500/50" title="Excluir" data-char-id="${char.id}" data-char-name="${char.name}">
                                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-trash-2"><path d="M3 6h18"/><path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"/><path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"/><line x1="10" x2="10" y1="11" y2="17"/><line x1="14" x2="14" y1="11" y2="17"/></svg>
                            </button>
                        </div>
                    `;
                    savedCharactersList.appendChild(charDiv);
                });

                document.querySelectorAll('.edit-character-button').forEach(button => {
                    button.addEventListener('click', (e) => {
                        const charId = e.currentTarget.dataset.charId;
                        const character = userCharacters.find(c => c.id === charId);
                        if (character) handleEditCharacter(character);
                    });
                });
                document.querySelectorAll('.delete-character-button').forEach(button => {
                    button.addEventListener('click', (e) => {
                        const charId = e.currentTarget.dataset.charId;
                        const charName = e.currentTarget.dataset.charName;
                        handleDeleteCharacter(charId, charName);
                    });
                });
            }
            charactersCountSpan.textContent = userCharacters.length;
        }

        function renderUserPrompts() {
            userPromptsList.innerHTML = '';
            if (userPrompts.length === 0) {
                promptHistorySection.classList.add('hidden');
            } else {
                promptHistorySection.classList.remove('hidden');
                userPrompts.forEach(p => {
                    const promptDiv = document.createElement('div');
                    promptDiv.className = 'bg-gray-700 p-4 rounded-lg shadow-md border border-gray-600 hover:border-blue-500 transition-colors duration-300';
                    const date = p.createdAt && p.createdAt.toDate ? p.createdAt.toDate() : new Date(p.createdAt); // Handle Firestore Timestamp vs Date
                    promptDiv.innerHTML = `
                        <p class="font-mono text-sm text-gray-200 break-words">${p.prompt}</p>
                        <p class="text-xs text-gray-400 mt-2">
                            Criado em: ${date.toLocaleString()}
                        </p>
                    `;
                    userPromptsList.appendChild(promptDiv);
                });
            }
        }

        // --- Core Logic Functions ---

        function buildInputPromptForAI() {
            let inputPrompt = `Gere um prompt de vídeo detalhado e profissional para IA (como Veo, Sora, Runway).`;
            inputPrompt += ` O prompt final deve ser na língua ${outputLanguageSelect.value === 'english' ? 'inglesa' : 'portuguesa'}.`;
            inputPrompt += ` Inclua todos os detalhes fornecidos e adicione elementos cinematográficos para torná-lo envolvente. O prompt deve ser direto e otimizado para modelos de texto para vídeo.`;

            const selectedCharacterIds = Array.from(charactersMultiSelect.selectedOptions).map(option => option.value);
            if (selectedCharacterIds.length > 0) {
                inputPrompt += "\n\nPersonagens Envolvidos e as suas Descrições (Mantenha Consistência):";
                selectedCharacterIds.forEach(charId => {
                    const character = userCharacters.find(uc => uc.id === charId);
                    if (character) {
                        inputPrompt += `\n- Nome: ${character.name}`;
                        if (character.description) inputPrompt += `\n  Descrição: ${character.description}`;
                        if (character.visualTraits) inputPrompt += `\n  Traços Visuais: ${character.visualTraits}`;
                        if (character.personalityTraits) inputPrompt += `\n  Traços de Personalidade: ${character.personalityTraits}`;
                        inputPrompt += `\n  **É crucial que este personagem mantenha a sua aparência e personalidade consistentes em todas as cenas.**`;
                    }
                });
                inputPrompt += "\n\n";
            }

            if (videoStyleSelect.value) inputPrompt += `\nEstilo do Vídeo: ${videoStyleSelect.value}.`;
            if (themeInput.value) inputPrompt += `\nTema/Ambiente: ${themeInput.value}.`;
            if (narrativeTextarea.value) inputPrompt += `\nNarrativa: ${narrativeTextarea.value}.`;
            if (cameraTypeSelect.value) inputPrompt += `\nTipo de Câmara/Movimento: ${cameraTypeSelect.value}.`;
            if (lightingSelect.value) inputPrompt += `\nIluminação: ${lightingSelect.value}.`;
            if (colorPaletteSelect.value) inputPrompt += `\nPaleta de Cores: ${colorPaletteSelect.value}.`;
            if (durationNumber.value) inputPrompt += `\nDuração: ${durationNumber.value} segundos.`;
            if (formatSelect.value) inputPrompt += `\nFormato: ${formatSelect.value}.`;
            if (qualityInput.value) inputPrompt += `\nQualidade e Detalhes: ${qualityInput.value}.`;
            if (voiceNarrationSelect.value) inputPrompt += `\nVoz/Narração: ${voiceNarrationSelect.value}.`;

            inputPrompt += `\n\nO prompt final deve ser conciso, cinematográfico e pronto para uso em ferramentas de IA na língua ${outputLanguageSelect.value === 'english' ? 'inglesa' : 'portuguesa'}. Priorize a consistência dos personagens descritos.`;
            return inputPrompt;
        }

        async function generatePromptWithAI() {
            isLoadingPrompt = true;
            generatedPromptTextarea.value = 'Gerando prompt com IA... por favor, aguarde.';
            loadingOverlay.classList.remove('hidden');
            generatePromptButton.disabled = true;
            showFeedback('', '');

            const prompt = buildInputPromptForAI();
            let chatHistory = [];
            chatHistory.push({ role: "user", parts: [{ text: prompt }] });

            const payload = { contents: chatHistory };
            const apiKey = ""; // Canvas will provide this at runtime, but for external hosting, you might need a different API key or proxy
            const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;

            try {
                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(`Erro da API: ${response.status} - ${errorData.error?.message || response.statusText}`);
                }

                const result = await response.json();

                if (result.candidates && result.candidates.length > 0 &&
                    result.candidates[0].content && result.candidates[0].content.parts &&
                    result.candidates[0].content.parts.length > 0) {
                    const text = result.candidates[0].content.parts[0].text;
                    generatedPromptTextarea.value = text;
                    showFeedback('success', 'Prompt gerado com sucesso pela IA!');
                } else {
                    showFeedback('error', 'A IA não conseguiu gerar um prompt. Tente novamente com mais detalhes.');
                    console.error("Estrutura de resposta inesperada da API:", result);
                }
            } catch (error) {
                showFeedback('error', `Erro ao gerar prompt: ${error.message}`);
                console.error("Erro ao chamar a API Gemini:", error);
                generatedPromptTextarea.value = 'Erro ao gerar prompt. Por favor, tente novamente.';
            } finally {
                isLoadingPrompt = false;
                loadingOverlay.classList.add('hidden');
                generatePromptButton.disabled = false;
            }
        }

        function copyPrompt() {
            if (generatedPromptTextarea.value) {
                generatedPromptTextarea.select();
                try {
                    document.execCommand('copy');
                    showFeedback('success', 'Prompt copiado para a área de transferência!');
                } catch (err) {
                    console.error('Falha ao copiar:', err);
                    showFeedback('error', 'Não foi possível copiar o prompt.');
                }
            } else {
                showFeedback('error', 'Nenhum prompt para copiar!');
            }
        }

        async function savePrompt() {
            if (!currentUserId || (auth.currentUser && auth.currentUser.isAnonymous)) {
                showFeedback('error', "Por favor, inicie sessão (com e-mail/senha ou Google) para guardar os seus prompts. Usuários anônimos não podem salvar dados.");
                return;
            }
            if (!generatedPromptTextarea.value) {
                showFeedback('error', "Nenhum prompt para guardar!");
                return;
            }

            try {
                const promptsCollectionRef = collection(db, `artifacts/${appId}/users/${currentUserId}/prompts`);
                await addDoc(promptsCollectionRef, {
                    prompt: generatedPromptTextarea.value,
                    createdAt: new Date(),
                    videoStyle: videoStyleSelect.value,
                    theme: themeInput.value,
                    narrative: narrativeTextarea.value,
                    characters: Array.from(charactersMultiSelect.selectedOptions).map(option => option.value),
                    cameraType: cameraTypeSelect.value,
                    lighting: lightingSelect.value,
                    colorPalette: colorPaletteSelect.value,
                    duration: parseInt(durationNumber.value),
                    format: formatSelect.value,
                    quality: qualityInput.value,
                    outputLanguage: outputLanguageSelect.value,
                    voiceNarration: voiceNarrationSelect.value
                });
                showFeedback('success', "Prompt guardado com sucesso!");
            } catch (error) {
                console.error("Erro ao guardar o prompt:", error);
                showFeedback('error', "Erro ao guardar o prompt. Tente novamente.");
            }
        }

        function resetForm() {
            videoStyleSelect.value = '';
            themeInput.value = '';
            narrativeTextarea.value = '';
            // Reset multi-select characters
            Array.from(charactersMultiSelect.options).forEach(option => option.selected = false);
            charactersMultiSelect.value = ''; // Ensure it's visually reset
            populateCharactersMultiSelect(); // Repopulate to show "Nenhum personagem..." if empty
            
            cameraTypeSelect.value = '';
            lightingSelect.value = '';
            colorPaletteSelect.value = '';
            durationRange.value = 10;
            durationNumber.value = 10;
            formatSelect.value = '';
            qualityInput.value = '';
            generatedPromptTextarea.value = '';
            outputLanguageSelect.value = 'portuguese';
            voiceNarrationSelect.value = '';
            showFeedback('', '');
            isManualInputMode = false;
            generatedPromptTextarea.readOnly = true;
            toggleManualModeButton.innerHTML = `<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-type mr-2"><polyline points="4 7 4 4 20 4 20 7"/><line x1="9" x2="15" y1="20" y2="20"/><line x1="12" x2="12" y1="4" y2="20"/></svg> Introduzir Manualmente`;
            generatePromptButton.style.display = 'inline-flex';
        }

        // --- Event Listeners ---

        document.addEventListener('DOMContentLoaded', () => {
            // Populate select options
            populateSelect(videoStyleSelect, videoStyleOptions, '');
            populateSelect(cameraTypeSelect, cameraTypeOptions, '');
            populateSelect(lightingSelect, lightingOptions, '');
            populateSelect(colorPaletteSelect, colorPaletteOptions, '');
            populateSelect(formatSelect, formatOptions, '');
            populateSelect(outputLanguageSelect, outputLanguageOptions, 'portuguese');
            populateSelect(voiceNarrationSelect, voiceNarrationOptions, '');

            // Initial render of entry page
            entryPage.classList.remove('hidden');
            mainApp.classList.add('hidden');

            // Set up Firebase auth state listener
            // Only attach if Firebase app is initialized
            if (auth) {
                onAuthStateChanged(auth, handleAuthStateChanged);
            } else {
                // If Firebase failed to initialize, set isAuthReady to true and handle as anonymous
                isAuthReady = true;
                currentUserId = crypto.randomUUID(); // Generate a random ID for anonymous fallback
                currentUserEmail = 'Anónimo (Firebase não inicializado)';
                updateAuthUI();
                // No Firestore listeners if db is not initialized
            }


            // Entry Page Button
            enterPlatformButton.addEventListener('click', () => {
                setTimeout(() => {
                    entryPage.classList.add('hidden');
                    mainApp.classList.remove('hidden');
                }, 500);
            });

            // Header Media URL Input
            headerMediaUrlInput.addEventListener('input', (e) => {
                updateHeaderMedia(e.target.value);
            });
            // Initial load of header media
            updateHeaderMedia(headerMediaUrlInput.value);


            // Sidebar Toggles
            sidebarToggle.addEventListener('click', () => {
                isSidebarOpen = !isSidebarOpen;
                renderSidebar();
            });
            sidebarCloseButton.addEventListener('click', () => {
                isSidebarOpen = false;
                renderSidebar();
            });

            // Auth Modal Buttons
            authModalCloseButton.addEventListener('click', () => { showAuthModal = false; renderModals(); });
            authForm.addEventListener('submit', (e) => {
                e.preventDefault();
                if (isRegisterMode) {
                    handleRegister();
                } else {
                    handleLogin();
                }
            });
            authToggleButton.addEventListener('click', () => {
                isRegisterMode = !isRegisterMode;
                renderModals();
            });
            googleSignInButton.addEventListener('click', handleGoogleSignIn);

            // Profile Modal Buttons
            profileModalCloseButton.addEventListener('click', () => { showProfileModal = false; renderModals(); });
            saveProfileButton.addEventListener('click', handleSaveProfile);

            // Plans Modal Buttons
            plansButtonDesktop.addEventListener('click', () => { showPlansModal = true; renderModals(); });
            plansButtonMobile.addEventListener('click', () => { showPlansModal = true; isSidebarOpen = false; renderSidebar(); renderModals(); });
            plansModalCloseButton.addEventListener('click', () => { showPlansModal = false; renderModals(); });

            // Character Manager Buttons
            manageCharactersButton.addEventListener('click', () => { isCharacterManagerOpen = true; editingCharacter = null; renderModals(); });
            myCharactersButtonDesktop.addEventListener('click', () => { isCharacterManagerOpen = true; editingCharacter = null; renderModals(); });
            myCharactersButtonMobile.addEventListener('click', () => { isCharacterManagerOpen = true; editingCharacter = null; isSidebarOpen = false; renderSidebar(); renderModals(); });
            characterManagerCloseButton.addEventListener('click', () => {
                isCharacterManagerOpen = false;
                editingCharacter = null;
                newCharacterNameInput.value = '';
                newCharacterDescriptionInput.value = '';
                newCharacterVisualsInput.value = '';
                newCharacterPersonalityInput.value = '';
                renderModals();
            });
            saveCharacterButton.addEventListener('click', handleSaveCharacter);
            cancelEditCharacterButton.addEventListener('click', () => {
                editingCharacter = null;
                newCharacterNameInput.value = '';
                newCharacterDescriptionInput.value = '';
                newCharacterVisualsInput.value = '';
                newCharacterPersonalityInput.value = '';
                renderModals(); // Re-render to clear form and hide cancel button
            });

            // Form Field Event Listeners
            durationRange.addEventListener('input', (e) => {
                durationNumber.value = e.target.value;
            });
            durationNumber.addEventListener('input', (e) => {
                durationRange.value = e.target.value;
            });

            // Prompt Generation Buttons
            generatePromptButton.addEventListener('click', generatePromptWithAI);
            copyPromptButton.addEventListener('click', copyPrompt);
            resetFormButton.addEventListener('click', resetForm);
            savePromptButton.addEventListener('click', savePrompt);

            toggleManualModeButton.addEventListener('click', () => {
                isManualInputMode = !isManualInputMode;
                generatedPromptTextarea.readOnly = !isManualInputMode;
                if (isManualInputMode) {
                    toggleManualModeButton.innerHTML = `<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-rotate-ccw mr-2"><path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"/><path d="M3 3v5h5"/></svg> Voltar ao Modo IA`;
                    generatePromptButton.style.display = 'none';
                } else {
                    toggleManualModeButton.innerHTML = `<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-type mr-2"><polyline points="4 7 4 4 20 4 20 7"/><line x1="9" x2="15" y1="20" y2="20"/><line x1="12" x2="12" y1="4" y2="20"/></svg> Introduzir Manualmente`;
                    generatePromptButton.style.display = 'inline-flex';
                    generatedPromptTextarea.value = ''; // Clear for AI generation
                }
            });

            // YouTube Video Players
            youtubeVideoId1Input.addEventListener('input', () => renderYouTubePlayer('youtube-video-id-1', 'youtube-player-1'));
            youtubeVideoId2Input.addEventListener('input', () => renderYouTubePlayer('youtube-video-id-2', 'youtube-player-2'));
            youtubeVideoId3Input.addEventListener('input', () => renderYouTubePlayer('youtube-video-id-3', 'youtube-player-3'));
            youtubeVideoId4Input.addEventListener('input', () => renderYouTubePlayer('youtube-video-id-4', 'youtube-player-4'));
        });
    </script>
</body>
</html>
